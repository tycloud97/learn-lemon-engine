"use strict";module.exports=function(r,e,o){e=e||"HS";var i=r.U,n=r._;if(!i)throw new Error("$U is required!");if(!n)throw new Error("$_ is required!");var c=i.NS(e,"magenta"),w=o,f=require("request"),m=require("query-string");if(!w)throw new Error("endpoint is required!");if(!f)throw new Error("request is required!");var t={endpoint:o},q=r.log,v=(r.inf,r.err);t.do_get=function(r,e,o,i,n){return n?Promise.reject(new Error(c+":$body is invalid!")):void 0===r?Promise.reject(new Error(c+":TYPE is required!")):d("GET",r,e,o,i,n)},t.do_put=function(r,e,o,i,n){return void 0===r?Promise.reject(new Error(c+":TYPE is required!")):void 0===e?Promise.reject(new Error(c+":ID is required!")):d("PUT",r,e,o,i,n)},t.do_post=function(r,e,o,i,n){return void 0===r?Promise.reject(new Error(c+":TYPE is required!")):void 0===e?Promise.reject(new Error(c+":ID is required!")):d("POST",r,e,o,i,n)},t.do_delete=function(r,e,o,i,n){return void 0===r?Promise.reject(new Error(c+":TYPE is required!")):void 0===e?Promise.reject(new Error(c+":ID is required!")):d("DELETE",r,e,o,i,n)},r(e,t);var d=function(r,e,o,i,n,t){if(!r)return Promise.reject(new Error(c+":METHOD is required!"));var d=n?m.stringify(n):"",s=w+(void 0===e?"":"/"+encodeURIComponent(e))+(void 0===o?"":"/"+encodeURIComponent(o))+(void 0===i?"":"/"+encodeURIComponent(i))+(d?"?"+d:""),u=f,E={method:r||"GET",uri:s,body:t,json:!0};return q(c,"*",E.method,s),new Promise(function(t,d){u(E,function(r,e,o){if(r&&v(c,">>>>> requested! err=",r),r)return d(r);var i=e.statusCode,n=e.statusMessage;if(200!==i)return q(c,"> code="+i+", msg="+n+", body=",o),d("string"==typeof(o=o||n)?new Error(o):o);t(o)})})};return t};