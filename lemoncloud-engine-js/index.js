"use strict";function initialize(r,e){var i=this;if(!r)throw new Error("$export is required.");if(!i)throw new Error("_$ is required.");if("function"!=typeof i)throw new Error("_$ should be function.");i.log;var o=i.inf,t=(i.err,i.environ("STAGE",""));t&&o("#STAGE =",t);var n=require("./lib/utilities")(i);i("U",n),require("./lib/mysql-proxy")(i,"MS"),require("./lib/dynamo-proxy")(i,"DS"),require("./lib/redis-proxy")(i,"RS"),require("./lib/elastic-proxy")(i,"ES"),require("./lib/sqs-proxy")(i,"SS"),require("./lib/web-proxy")(i,"WS"),require("./lib/cognito-proxy")(i,"CS");var u=require("./core/lemon-engine-model");i("LEM",u),require("./service/messages-service")(i,"MMS");var s=require("./api/_meta-api")(i),a=require("./api/group-api")(i),l=require("./api/user-api")(i),c=require("./api/chat-api")(i);return Object.assign(r,{createModel:function(r,e){return u(i,r,e)},_meta:s,user:l,group:a,chat:c})}module.exports=function(r,t){r=r||new function(){};var e=(t=t||{}).name||"lemon",i=p("STAGE",""),o="local"===i||"express"===i||"1"===p("LC",""),n={thiz:console,log:console.log,error:console.error,auto_ts:o,auto_color:o},u=function(){var r=n.auto_ts&&!Array.isArray(arguments)&&Array.prototype.slice.call(arguments)||arguments;return n.auto_color?(r.unshift("[0m"),n.auto_ts&&r.unshift(c(),"L"),r.unshift("[32m")):n.auto_ts&&r.unshift(c(),"L"),n.log.apply(n.thiz,r)},s=function(){var r=n.auto_ts&&!Array.isArray(arguments)&&Array.prototype.slice.call(arguments)||arguments;return n.auto_color?(r.unshift(""),r.push("[0m"),n.auto_ts&&r.unshift(c(),"I"),r.unshift("[33m")):n.auto_ts&&r.unshift(c(),"I"),n.log.apply(n.thiz,r)},a=function(){var r=n.auto_ts&&!Array.isArray(arguments)&&Array.prototype.slice.call(arguments)||arguments;return n.auto_color?(r.unshift("[0m"),n.auto_ts&&r.unshift(c(),"E"),r.unshift("[31m")):n.auto_ts&&r.unshift(c(),"E"),n.error.apply(n.thiz,r)},l=function(r,e){for(var i in e){var o=e[i];void 0===o?delete r[i]:r[i]=o}return r};function c(r){var e=r||new Date,i=[e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()],o=i[0],t=i[1],n=i[2],u=i[3],s=i[4],a=i[5];return(o<10?"0":"")+o+"-"+(t<10?"0":"")+t+"-"+(n<10?"0":"")+n+" "+(u<10?"0":"")+u+":"+(s<10?"0":"")+s+":"+(a<10?"0":"")+a}function p(r,e){var i=t.env||process&&process.env||{},o=i&&i[r]||void 0;if(e&&e instanceof Error&&void 0===o)throw e;return void 0===o?e:o}var f=function r(e,i){if(e){var o=r,t=void 0!==o[e]?o[e]:void 0;return void 0===i?t:void 0===t?(u("INFO! service["+e+"] registered"),o[e]=i):(a("WARN! service["+e+"] exists! so extends "),t=l(t=t||{},i=i||{}),o[e]=t)}};return f.STAGE=i,f.id=e,f.log=u,f.inf=s,f.err=a,f.extend=l,f.ts=c,f.environ=p,f.$console=n,f.toString=function(){return e||"$ROOT"},r._log=u,r._inf=s,r._err=a,r._$=f,(r[f.id]=f)("_",require("lodash/core")),initialize.apply(f,[r,t]),r};