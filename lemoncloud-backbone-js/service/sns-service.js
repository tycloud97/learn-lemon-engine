"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},_slicedToArray=function(r,e){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return function(r,e){var t=[],n=!0,i=!1,o=void 0;try{for(var s,u=r[Symbol.iterator]();!(n=(s=u.next()).done)&&(t.push(s.value),!e||t.length!==e);n=!0);}catch(r){i=!0,o=r}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return t}(r,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};module.exports=function(r,e){e=e||"SN";var n=r.U,o=r.aws,t=r._;if(!n)throw new Error("$U is required!");if(!o)throw new Error("$aws is required!");if(!t)throw new Error("$_ is required!");var s=r.log,u=(r.inf,r.err),a=n.NS(e,"magenta"),i={do_publish:function(r,e,t){if(!r)return Promise.reject("snsId is required!");if(!e)return Promise.reject("subject is required!");if(!t)return Promise.reject("payload is required!");r=l(r),t="object"==(void 0===t?"undefined":_typeof(t))?JSON.stringify(t):t;var i={TopicArn:r,Message:t};e&&(i.Subject=e);return s(a,"> params =",i),new Promise(function(t,n){c.publish(i,function(r,e){if(r)return n(r);t(e)})}).then(function(r){return s(a,"Sent message-id:",r&&r.MessageId||"#NOP"),r}).catch(function(r){throw u(a,"ERR! err=",r),r})},do_publish_sms:function(r,e,t){if(s(a,"do_publish_sms("+r+")...."),!r)return Promise.reject("phone is required!");if(!e)return Promise.reject("message is required!");var n=new o.SNS({region:"us-east-1"}),i={Message:"string"==typeof e?e:JSON.stringify(e),PhoneNumber:r};t&&(i.MessageAttributes={"AWS.SNS.SMS.SenderID":{DataType:"String",StringValue:t}});return s(a,"> params =",i),n.publish(i).promise().then(function(r){return s(a,"> sms.res =",r&&r.MessageId||"#NOP"),r}).catch(function(r){throw u(a,"> sms.err =",r),r})}};r(e,i);var f={region:n.env("SN_REGION",new Error(a+":SN_REGION is required!"))};s(a,"config=",f);var c=new o.SNS(f),l=function(r){var e=n.env("SN_CONFIG",new Error(a+":SN_CONFIG is required!"));if(e instanceof Error)throw e;var t=e.split(",").map(function(r){return r.trim()}).reduce(function(r,e){var t=e.split("=",2),n=_slicedToArray(t,2),i=n[0],o=n[1];return r[i]=o,r},{});if(r.startsWith("arn:"))return r;if(null==t[r])throw new Error(a+": unknown sns-pool id:"+r);return t[r]};return i};