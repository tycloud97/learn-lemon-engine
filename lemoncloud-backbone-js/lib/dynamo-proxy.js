"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};module.exports=function(t,i){i=i||"DS";var e=t.U,r=t._;if(!e)throw new Error("$U is required!");if(!r)throw new Error("$_ is required!");var s=e.NS(i,"magenta"),n=(t.log,t.inf,t.err,{do_create_table:function(e,r,t){if(!e)return Promise.reject(new Error(s+"parameter:table is required"));var i={idName:r,idType:t};return m().do_get(e,"0","create-table",i).then(function(e){return e.result})},do_delete_table:function(e){if(!e)return Promise.reject(new Error(s+"parameter:table is required"));var r=void 0;return m().do_get(e,"0","delete-table",r).then(function(e){return e.result})},do_list_tables:function(e,r){e=e||"#";var t={limit:r};return m().do_get(e,"0","list-table",t).then(function(e){return e.result})},do_create_item:function(e,r,t){if(!e)return Promise.reject(new Error(s+"parameter:table is required"));if(!r)return Promise.reject(new Error(s+"parameter:id is required"));if(!t)return Promise.reject(new Error(s+"parameter:data is required"));if("object"!==(void 0===t?"undefined":_typeof(t)))return Promise.reject(new Error(s+"parameter:data must be object"));var i={};if(r&&"object"===(void 0===r?"undefined":_typeof(r))){var n=r,o=n.idType;delete n.idType;var u=Object.keys(n);if(1!==u.length)return Promise.reject(new Error(s+":id is un-expected keys."));var d=u.pop()||"";r=n[d],i.idName=d,i.idType=o||("number"==typeof r?"Number":"String")}return m().do_post(e,r,void 0,i,t).then(function(e){return e.result})},do_get_item:function(e,r){if(!e)return Promise.reject(new Error(s+"parameter:table is required"));if(!r)return Promise.reject(new Error(s+"parameter:id is required"));var t={};if(r&&"object"===(void 0===r?"undefined":_typeof(r))){var i=r,n=i.idType;delete i.idType;var o=Object.keys(i);if(1!==o.length)return Promise.reject(new Error(s+":id is un-expected keys."));var u=o.pop()||"";r=i[u],t.idName=u,t.idType=n||("number"==typeof r?"Number":"String")}return m().do_get(e,r,void 0,t).then(function(e){return e.result})},do_delete_item:function(e,r){if(!e)return Promise.reject(new Error(s+"parameter:table is required"));if(!r)return Promise.reject(new Error(s+"parameter:id is required"));var t={};if(r&&"object"===(void 0===r?"undefined":_typeof(r))){var i=r,n=i.idType;delete i.idType;var o=Object.keys(i);if(1!==o.length)return Promise.reject(new Error(s+":id is un-expected keys."));var u=o.pop()||"";r=i[u],t.idName=u,t.idType=n||("number"==typeof r?"Number":"String")}return m().do_delete(e,r,void 0,t).then(function(e){return e.result})},do_update_item:function(e,r,t,i){if(!e)return Promise.reject(new Error(s+"parameter:table is required"));if(!r)return Promise.reject(new Error(s+"parameter:id is required"));if(!t)return Promise.reject(new Error(s+"parameter:data is required"));if("object"!==(void 0===t?"undefined":_typeof(t)))return Promise.reject(new Error(s+"parameter:data must be object"));var n={};if(r&&"object"===(void 0===r?"undefined":_typeof(r))){var o=r,u=o.idType;delete o.idType;var d=Object.keys(o);if(1!==d.length)return Promise.reject(new Error(s+":id is un-expected keys."));var a=d.pop()||"";r=o[a],n.idName=a,n.idType=u||("number"==typeof r?"Number":"String")}var f=t||{};i&&(f.$I=i);return m().do_put(e,r,void 0,n,f).then(function(e){return e.result})},do_increment_item:function(e,r,t,i){if(!e)return Promise.reject(new Error(s+"parameter:table is required"));if(!r)return Promise.reject(new Error(s+"parameter:id is required"));if(!t)return Promise.reject(new Error(s+"parameter:data is required"));if("object"!==(void 0===t?"undefined":_typeof(t)))return Promise.reject(new Error(s+"parameter:data must be object"));var n={};if(r&&"object"===(void 0===r?"undefined":_typeof(r))){var o=r,u=o.idType;delete o.idType;var d=Object.keys(o);if(1!==d.length)return Promise.reject(new Error(s+":id is un-expected keys."));var a=d.pop()||"";r=o[a],n.idName=a,n.idType=u||("number"==typeof r?"Number":"String")}var f=t||{};i&&(f.$I=i);return m().do_put(e,r,"increment",n,f).then(function(e){return e.result})},do_test_self:function(e){var r=e||{};return m().do_get("#","0","test-self",r).then(function(e){return e.result})},do_read_stream:function(e){var r=e||{},t=r.table;return delete r.table,m().do_get(t,"0","stream",r)}});t(i,n);var o=e.env("DS_ENDPOINT"),u=require("./http-proxy"),m=function(){if(!o)throw new Error("env:DS_ENDPOINT is required!");var e="X"+i,r=t(e);return r||u(t,e,o)};return n};