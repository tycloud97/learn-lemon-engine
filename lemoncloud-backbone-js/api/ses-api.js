"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};exports=module.exports=function(e,r){if(!e)throw new Error("_$(global instance pool) is required!");var t=e._,m=e.U,s=e.SE;if(!t)throw new Error("$_ is required!");if(!s)throw new Error("$SE is required!");var p=m.NS(r||"SESS","yellow"),E=e.log,b=(e.inf,e.err);function _(e){return T(404,e)}function S(e){return T(503,e)}function T(e,r){return{statusCode:e,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":!0},body:JSON.stringify(r)}}var o=function(e,r,t){r.callbackWaitsForEmptyEventLoop=!1;var o=e.queryStringParameters||{},n=e.pathParameters||{},i=decodeURIComponent(n.type||""),s=decodeURIComponent(n.id||""),c=(s||"GET"!==e.httpMethod?e.httpMethod:"LIST")||"",a=decodeURIComponent(n.cmd||""),u=!c&&e.Records?"EVENT":{LIST:"LIST",GET:"GET",PUT:"PUT",POST:"POST",DELETE:"DELETE"}[c],d=e.body&&("string"==typeof e.body&&(e.body.startsWith("{")||e.body.startsWith("["))?JSON.parse(e.body):e.body)||e.Records&&{records:e.Records}||null;!d&&E(p,"#"+u+":"+a+" ("+c+", "+i+"/"+s+")...."),d&&E(p,"#"+u+":"+a+" ("+c+", "+i+"/"+s+").... body.len=",d?m.json(d).length:-1);var l={_id:s,_type:i,_param:o,_body:d,_ctx:r},f=Promise.resolve(l),y=function(e,r,t,o){var n=null;switch(e){case"LIST":break;case"GET":"0"===t&&"test-self"===o&&(n=h);break;case"PUT":break;case"POST":"0"===t&&"send"===o&&(n=P)}return n}(u,0,s,a);if(!y)return t(null,_({MODE:u}));try{f.then(function(e){var r=e._id,t=e._type,o=e._param,n=e._body,i=e._ctx;return y(t,r,o,n,i)}).then(function(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))&&(e=m.cleanup(e)),t(null,T(200,e)),!0}).catch(function(e){return b(p,"!!! callback@1 with err",e),0<=(e&&e.message||"").indexOf("404 NOT FOUND")?t(null,_(e.message)):t(null,S(e.message||e)),!1})}catch(e){t(e,S(e.message))}};function P(r,e,t,o,n){if(E(p,"do_post_send_email("+r+"/"+e+")...."),"email"!=r)return Promise.reject(new Error("TYPE is invalid! TYPE:"+r));if("0"!=e)return Promise.reject(new Error("ID is  invalid! ID:"+e));if(!o)return Promise.reject(new Error("$body is required!"));var i=Object.assign({},o||{});return i?s.do_send_email(i).then(function(e){return E(p,"> pub-message["+r+"] :=",e),i.result=e,i}):Promise.reject(new Error("body is required!"))}function h(e,r,t,o,n){if(E(p,"do_get_test_self("+e+"/"+r+")...."),!e)return Promise.reject(new Error("TYPE is required!"));if("0"!==r)return Promise.reject(new Error("ID is invalid!"));var i=t?Object.assign({},t):{};return i?Promise.resolve(i):Promise.reject(new Error("node is required!"))}return o.do_post_send_email=P,o};