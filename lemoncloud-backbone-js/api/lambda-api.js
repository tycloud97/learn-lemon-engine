"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};exports=module.exports=function(e,r){if(!e)throw new Error("_$(global instance pool) is required!");var t=e._,b=e.U,a=e.LS;if(!t)throw new Error("$_ is required!");if(!a)throw new Error("$LS is required!");var p=b.NS(r||"LMDS","yellow"),_=e.log,y=(e.inf,e.err);function E(e){return T(404,e)}function h(e){return T(503,e)}function T(e,r){return{statusCode:e,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":!0},body:JSON.stringify(r)}}var o=function(e,r,t){r.callbackWaitsForEmptyEventLoop=!1;var o=e.queryStringParameters||{},n=e.pathParameters||{},i=decodeURIComponent(n.type||""),s=decodeURIComponent(n.id||""),a=(s||"GET"!==e.httpMethod?e.httpMethod:"LIST")||"",d=decodeURIComponent(n.cmd||""),u=!a&&e.Records?"EVENT":{LIST:"LIST",GET:"GET",PUT:"PUT",POST:"POST",DELETE:"DELETE"}[a],c=e.body&&("string"==typeof e.body&&(e.body.startsWith("{")||e.body.startsWith("["))?JSON.parse(e.body):e.body)||e.Records&&{records:e.Records}||null;!c&&_(p,"#"+u+":"+d+" ("+a+", "+i+"/"+s+")...."),c&&_(p,"#"+u+":"+d+" ("+a+", "+i+"/"+s+").... body.len=",c?b.json(c).length:-1);var l={_id:s,_type:i,_cmd:d,_param:o,_body:c,_ctx:r},m=Promise.resolve(l),f=function(e,r,t,o){var n=null;switch(e){case"LIST":case"GET":n=P;break;case"PUT":n=g;break;case"POST":n=v;break;case"DELETE":n=w}return n}(u);if(!f)return t(null,E({MODE:u}));try{m.then(function(e){var r=e._id,t=e._cmd,o=e._type,n=e._param,i=e._body,s=e._ctx;return f(o,r,t,n,i,s)}).then(function(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))&&(e=b.cleanup(e)),t(null,T(200,e)),!0}).catch(function(e){return 0<=(e&&(e.message||e.reason)||"").indexOf("404 NOT FOUND")?t(null,E(e.message)):(y(p,"!!! callback@1-2 with err",e),t(null,h(e.message||e.reason||e))),!1})}catch(e){t(e,h(e.message))}};function P(r,e,t,o,n,i){if(_(p,"do_get_lambda("+r+"/"+e+")...."),e=e||"",!r)return Promise.reject(new Error("TYPE is required!"));var s=o?Object.assign({},o):{};return s?a.do_get(r,e,t||void 0,o,n,i).then(function(e){return _(p,"> lambda-get["+r+"] :=",e),s.result=e,s}):Promise.reject(new Error("node is required!"))}function g(r,e,t,o,n,i){if(_(p,"do_put_lambda("+r+"/"+e+")...."),e=e||"",!r)return Promise.reject(new Error("TYPE is required!"));var s=o?Object.assign({},o):{};return s?a.do_put(r,e,t||void 0,o,n,i).then(function(e){return _(p,"> lambda-put["+r+"] :=",e),s.result=e,s}):Promise.reject(new Error("node is required!"))}function v(r,e,t,o,n,i){if(_(p,"do_post_lambda("+r+"/"+e+")...."),e=e||"",!r)return Promise.reject(new Error("TYPE is required!"));var s=o?Object.assign({},o):{};return s?a.do_post(r,e,t||void 0,o,n,i).then(function(e){return _(p,"> lambda-post["+r+"] :=",e),s.result=e,s}):Promise.reject(new Error("node is required!"))}function w(e,r,t,o,n,i){if(_(p,"do_delete_lambda("+host+"/"+path+")...."),path=path||"",!host)return Promise.reject(new Error("TYPE is required!"));var s=o?Object.assign({},o):{};return s?a.do_delete(e,r,t||void 0,o,n,i).then(function(e){return _(p,"> lambda-del["+host+"] :=",e),s.result=e,s}):Promise.reject(new Error("node is required!"))}return o.do_get_lambda=P,o.do_put_lambda=g,o.do_post_lambda=v,o.do_delete_lambda=w,o};